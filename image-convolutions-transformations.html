<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Image convolutions and transformations</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="css/worg.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<a href="index.html">Home</a> &nbsp; &nbsp;
          <!-- Plupper Button -->
          <!-- <div id="plupperButton" style="display: inline;"></div> -->
          <!-- End of Plupper Button Code -->
</div>
<div id="content">
<h1 class="title">Image convolutions and transformations</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Linear filters (convolutions)</a></li>
<li><a href="#sec-2">Erosion</a></li>
<li><a href="#sec-3">Dilation</a></li>
<li><a href="#sec-4">Remapping</a></li>
<li><a href="#sec-5">Affine transformations</a>
<ul>
<li><a href="#sec-5-1">Examples</a></li>
</ul>
</li>
<li><a href="#sec-6">Perspective transformations</a></li>
<li><a href="#sec-7">Source code</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Linear filters (convolutions)</h2>
<div class="outline-text-2" id="text-1">
<img align="left" src="images/blur-convolution.png" style="margin: 0 10px 10px 0;"/>

<p>
$$\text{dst}(x,y) = \sum_{0 \leq x' < c, \quad 0 \leq y' < r} K(x',y') * \text{src}(x + x'- x_a, y + y' - y_a)$$
</p>

<p>
where \(K\) is the kernel, \(c\) is the number of columns in the kernel,
\(r\) is the number of rows in the kernel, \(x_a\) is the \(x\) position of
the anchor (in the kernel), and \(y_a\) is the \(y\) position of the
anchor.
</p>

<div style="clear: both;"/>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><img src="./images/lena-blur10x10.jpg" alt="lena-blur10x10.jpg" /></td>
<td class="left"><img src="./images/lena-blur20x20.jpg" alt="lena-blur20x20.jpg" /></td>
<td class="left"><img src="./images/lena-blur20x1.jpg" alt="lena-blur20x1.jpg" /></td>
</tr>

<tr>
<td class="left">Kernel is 10x10, all values equal to 0.01</td>
<td class="left">Kernel is 20x20, all values equal to 0.0025</td>
<td class="left">Kernel is 20x1, all values equal to 0.05</td>
</tr>
</tbody>
</table>


<p>
We can also achieve a sharpening effect.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><img src="./images/sharpen-convolution.png" alt="sharpen-convolution.png" /></td>
<td class="left"><img src="./images/lena-sharpen.jpg" alt="lena-sharpen.jpg" /></td>
</tr>
</tbody>
</table>

<div class="center">

<div class="figure">
<p><img src="./images/3D_Convolution_Animation.gif" alt="3D_Convolution_Animation.gif" />
</p>
</div>

<p>
From <a href="http://en.m.wikipedia.org/wiki/File:3D_Convolution_Animation.gif">Wikipedia</a>
</p>
</div>

<p>
And we can achieve an edge effect.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><img src="./images/edge-convolution.png" alt="edge-convolution.png" /></td>
<td class="left"><img src="./images/lena-edges.jpg" alt="lena-edges.jpg" /></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Erosion</h2>
<div class="outline-text-2" id="text-2">
<p>
$$\text{dst}(x,y) = \min_{(x',y'): K(x',y') \neq 0} \text{src}(x+x', y+y')$$
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><img src="./images/lena-erode4x4.jpg" alt="lena-erode4x4.jpg" /></td>
<td class="left"><img src="./images/lena-binary.jpg" alt="lena-binary.jpg" /></td>
<td class="left"><img src="./images/lena-binary-erode4x4.jpg" alt="lena-binary-erode4x4.jpg" /></td>
</tr>

<tr>
<td class="left">Erosion with a 4x4 kernel of 1's</td>
<td class="left">Lena in binary</td>
<td class="left">Binary image eroded by 4x4 kernel of 1's</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Dilation</h2>
<div class="outline-text-2" id="text-3">
<p>
$$\text{dst}(x,y) = \max_{(x',y'): K(x',y') \neq 0} \text{src}(x+x', y+y')$$
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><img src="./images/lena-dilate4x4.jpg" alt="lena-dilate4x4.jpg" /></td>
<td class="left"><img src="./images/lena-binary.jpg" alt="lena-binary.jpg" /></td>
<td class="left"><img src="./images/lena-binary-dilate4x4.jpg" alt="lena-binary-dilate4x4.jpg" /></td>
</tr>

<tr>
<td class="left">Dilation with a 4x4 kernel of 1's</td>
<td class="left">Lena in binary</td>
<td class="left">Binary image dilated by 4x4 kernel of 1's</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Remapping</h2>
<div class="outline-text-2" id="text-4">
<p>
$$\text{dst}(x,y) = \text{src}(\text{map}_x(x,y), \text{map}_y(x,y))$$
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Affine transformations</h2>
<div class="outline-text-2" id="text-5">
<p>
An affine transformation is any transformation that can be specified
as a linear transformation (matrix multiplication) plus a translation
(vector addition).
</p>

<p>
Affine transformations include: rotations, translations, scaling, and
combinations of these.
</p>

\begin{equation}
A = \begin{bmatrix} a_{00} & a_{01} \\ a_{10} & a_{11} \end{bmatrix}
B = \begin{bmatrix} b_{00} \\ b_{10} \end{bmatrix}
\end{equation}

\begin{equation}
M = [A;B] = \begin{bmatrix} a_{00} & a_{01} & b_{00} \\ a_{10} & a_{11} & b_{10} \end{bmatrix}
\end{equation}

<p>
Then we take a point, \([x, y]^T\), add an extra \(z\) dimension set to
\(1\) ("homogeneous coordinates"), and multiply:
</p>

\begin{equation}
T = M \times [x, y, 1]^T = \begin{bmatrix} a_{00}x + a_{01}y + b_{00} \\ a_{10}x + a_{11}y + b_{10} \end{bmatrix}
\end{equation}
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Examples</h3>
<div class="outline-text-3" id="text-5-1">
<p>
The identity transformation:
</p>

\begin{equation}
A = \begin{bmatrix} 1 & 0 & 0 \\ 0 & 1 & 0 \end{bmatrix}
\end{equation}

<p>
Scale the image to half its size:
</p>

\begin{equation}
A = \begin{bmatrix} 0.5 & 0 & 0 \\ 0 & 0.5 & 0 \end{bmatrix}
\end{equation}

<p>
Here is a 90-degree rotation:
</p>

\begin{eqnarray}
M &=& \begin{bmatrix}
\cos(\pi/2) & \sin(\pi/2) & (1-\cos(\pi/2))x_c - \sin(\pi/2)y_c \\
-\sin(\pi/2) & \cos(\pi/2) & \sin(pi/2)x_c + (1-\cos(pi/2))y_c
\end{bmatrix} \\
&=& \begin{bmatrix}
0 & 1 & x_c - y_c \\
-1 & 0 & x_c + y_c
\end{bmatrix}
\end{eqnarray}

<p>
where \(x_c, y_c\) is the location of the center of the image.
</p>

<p>
Here is a 45-degree rotation:
</p>

\begin{equation}
M = \begin{bmatrix}
\cos(\pi/4) & \sin(\pi/4) & (1-\cos(\pi/4))x_c - \sin(\pi/4)y_c \\
-\sin(\pi/4) & \cos(\pi/4) & \sin(pi/4)x_c + (1-\cos(pi/4))y_c
\end{bmatrix}
\end{equation}

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><img src="./images/lena-scaled.jpg" alt="lena-scaled.jpg" /></td>
<td class="left"><img src="./images/lena-scaled-trans.jpg" alt="lena-scaled-trans.jpg" /></td>
<td class="left"><img src="./images/lena-45-rotate.jpg" alt="lena-45-rotate.jpg" /></td>
</tr>

<tr>
<td class="left">Scaled, no translation</td>
<td class="left">Scaled, with translation</td>
<td class="left">45-degree rotation plus translation</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Perspective transformations</h2>
<div class="outline-text-2" id="text-6">
<img align="left" src="images/lena-perspective.jpg" style="margin: 0 10px 10px 0;"/>

\begin{equation}
M = \begin{bmatrix} a_{00} & a_{01} & a_{02} \\ a_{10} & a_{11} & a_{12} \\ a_{20} & a_{21} & 1.0 \end{bmatrix}
\end{equation}

\begin{equation}
[x', y', w]^T = M \times [x, y, 1]^T =
\begin{bmatrix}
a_{00}x + a_{01}y + a_{02} \\
a_{10}x + a_{11}y + a_{12} \\
a_{20}x + a_{21}y + 1.0
\end{bmatrix}
\end{equation}

<p>
Then we divide out \(w\), yielding: \([\frac{x'}{w}, \frac{y'}{w},
1]^T\). We therefore draw the point \((\frac{x'}{w}, \frac{y'}{w})\).
</p>

<p>
The example on the left uses this kernel:
</p>

\begin{equation}
M = \begin{bmatrix}
0.53009 & -0.47993 & 79.0 \\
-0.31048 & 0.50159 & 59.0 \\
-0.00094 & -0.00131 & 1.0
\end{bmatrix}
\end{equation}

<p>
Because an perspective transformation is a \(3 \times 3\) matrix with
eight unknowns, we can determine the transformation between any two
images with only four 2D points.
</p>

<p>
We could, for example, take a skewed view from a surveillance camera,
and figure out the actual plane being viewed (assuming we are
monitoring a flat area), by just figuring out the ground coordinates
of four pixels in the video.
</p>

<p>
Of course, surveillance videos often have low resolution, so we
probably cannot pick out the exact ground coordinates of any
pixels. We can instead approximate the affine transformation; that is,
we can find the transformation that minimizes the error. Four point
correspondances is now not enough; we need lots, maybe 50 or 100, the
more the better. (<i>Perhaps we can automatically find these.</i>) Then
different transformations can be tested, and we can pick out the one
that minimizes the error between chosen ground coordinates and
predicted ground coordinates (from the transformation). This learning
can be achieved with a single layer neural network.
</p>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Source code</h2>
<div class="outline-text-2" id="text-7">
<p>
Grab the source code for all of these examples:
<a href="https://github.com/joshuaeckroth/teach-computer-vision">https://github.com/joshuaeckroth/teach-computer-vision</a>
</p>

<div style="font-size: 80%; clear: both;"> <span
xmlns:dct="http://purl.org/dc/terms/"
href="http://purl.org/dc/dcmitype/Text" property="dct:title"
rel="dct:type">Intro to AI material</span> by <a
xmlns:cc="http://creativecommons.org/ns#"
href="http://cse3521.artifice.cc" property="cc:attributionName"
rel="cc:attributionURL">Joshua Eckroth</a> is licensed under a <a
rel="license"
href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
Attribution-ShareAlike 3.0 Unported License</a>. Source code for this
website available at <a
href="https://github.com/joshuaeckroth/cse3521-website">GitHub</a>.
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-23971505-3', 'artifice.cc');
  ga('send', 'pageview');

</script>

<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<script type="text/javascript">
$('.hidden .hidden-content').hide();
$('.hidden > strong').click(function() {
  $(this).parent().find('.hidden-content').toggle();
});
</script>
</div>
</div>
</div>
</body>
</html>
